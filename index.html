<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HealthFlow - Smart Follow-Up & Telemedicine Platform</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #667eea 0%,
          #764ba2 50%,
          #f093fb 100%
        );
        min-height: 100vh;
        color: #333;
        overflow-x: hidden;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        color: white;
        position: relative;
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50px;
        left: 50%;
        transform: translateX(-50%);
        width: 200px;
        height: 200px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        border-radius: 50%;
        animation: pulse-glow 3s ease-in-out infinite;
      }

      .header h1 {
        font-size: 3em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        animation: fadeInDown 1s ease-out;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
        animation: fadeInUp 1s ease-out 0.3s both;
      }

      .hero-video {
        width: 100%;
        max-width: 800px;
        margin: 0 auto 40px;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        animation: slideInUp 1s ease-out 0.5s both;
      }

      .hero-video video {
        width: 100%;
        height: auto;
        display: block;
      }

      .video-overlay {
        position: relative;
        background: linear-gradient(
          45deg,
          rgba(102, 126, 234, 0.9),
          rgba(118, 75, 162, 0.9)
        );
        padding: 20px;
        text-align: center;
        color: white;
      }

      .video-overlay h3 {
        margin-bottom: 10px;
        font-size: 1.5em;
      }

      .video-overlay p {
        opacity: 0.9;
        line-height: 1.6;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
      }

      .stats {
        grid-column: 1 / -1;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        padding: 25px;
        text-align: center;
        transition: all 0.4s ease;
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(102, 126, 234, 0.1),
          transparent
        );
        transition: left 0.8s;
      }

      .stat-card:hover::before {
        left: 100%;
      }

      .stat-card:hover {
        border-color: #667eea;
        transform: translateY(-10px) scale(1.05);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      }

      .stat-icon {
        font-size: 2.5em;
        margin-bottom: 10px;
        display: block;
      }

      .stat-number {
        font-size: 2.8em;
        font-weight: bold;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #718096;
        font-weight: 600;
        font-size: 0.9em;
      }

      .card {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 25px;
        padding: 30px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        transition: all 0.4s ease;
        animation: slideInUp 0.8s ease-out;
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
        border-radius: 25px;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .card:hover::before {
        opacity: 1;
      }

      .card:hover {
        transform: translateY(-15px);
        box-shadow: 0 35px 70px rgba(0, 0, 0, 0.25);
      }

      .card h2 {
        color: #4a5568;
        margin-bottom: 25px;
        font-size: 1.6em;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .icon {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        font-size: 1.2em;
      }

      .icon.patient {
        background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
      }
      .icon.doctor {
        background: linear-gradient(45deg, #4ecdc4, #44a08d);
      }
      .icon.reminder {
        background: linear-gradient(45deg, #ffa726, #ffcc02);
      }
      .icon.analytics {
        background: linear-gradient(45deg, #9c27b0, #e91e63);
      }
      .icon.upload {
        background: linear-gradient(45deg, #00bcd4, #2196f3);
      }
      .icon.video {
        background: linear-gradient(45deg, #f44336, #e91e63);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #4a5568;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 14px 18px;
        border: 2px solid #e2e8f0;
        border-radius: 15px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.9);
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        transform: scale(1.02);
      }

      .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 15px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 10px;
        position: relative;
        overflow: hidden;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      }

      .btn:active {
        transform: translateY(-1px);
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.6s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn.secondary {
        background: linear-gradient(45deg, #48bb78, #38a169);
      }

      .btn.danger {
        background: linear-gradient(45deg, #f56565, #e53e3e);
      }

      .file-upload {
        border: 3px dashed #cbd5e0;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      }

      .file-upload:hover {
        border-color: #667eea;
        background: linear-gradient(135deg, #edf2f7, #e2e8f0);
        transform: scale(1.02);
      }

      .file-upload.dragover {
        border-color: #667eea;
        background: linear-gradient(
          135deg,
          rgba(102, 126, 234, 0.1),
          rgba(118, 75, 162, 0.1)
        );
      }

      .file-list {
        margin-top: 20px;
      }

      .file-item {
        background: #f7fafc;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.3s ease;
      }

      .file-item:hover {
        background: #edf2f7;
        transform: translateX(5px);
      }

      .video-call-section {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-radius: 25px;
        padding: 30px;
        text-align: center;
      }

      .video-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      .video-preview {
        background: #2d3748;
        border-radius: 15px;
        aspect-ratio: 16/9;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #a0aec0;
        font-size: 1.2em;
        position: relative;
        overflow: hidden;
      }

      .video-preview video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 15px;
      }

      .video-controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
      }

      .control-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        color: white;
        font-size: 1.2em;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .control-btn.call {
        background: linear-gradient(45deg, #48bb78, #38a169);
      }

      .control-btn.end {
        background: linear-gradient(45deg, #f56565, #e53e3e);
      }

      .control-btn.mute {
        background: linear-gradient(45deg, #ed8936, #dd6b20);
      }

      .control-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      .reminder-list {
        grid-column: 1 / -1;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 25px;
        padding: 30px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .reminder-item {
        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 15px;
        border-left: 5px solid #667eea;
        transition: all 0.4s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .reminder-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(102, 126, 234, 0.1),
          transparent
        );
        transition: left 0.6s;
      }

      .reminder-item:hover::before {
        left: 100%;
      }

      .reminder-item:hover {
        transform: translateX(15px) scale(1.02);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }

      .reminder-item.urgent {
        border-left-color: #f56565;
        animation: pulse-urgent 2s infinite;
      }

      .reminder-item.completed {
        opacity: 0.7;
        border-left-color: #48bb78;
      }

      .ai-insights {
        background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
        color: white;
        border-radius: 25px;
        padding: 30px;
        margin-top: 30px;
        position: relative;
        overflow: hidden;
      }

      .ai-insights::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: rotate 25s linear infinite;
      }

      .ai-insights h3 {
        margin-bottom: 15px;
        position: relative;
        z-index: 1;
        font-size: 1.5em;
      }

      .ai-insights p {
        position: relative;
        z-index: 1;
        line-height: 1.7;
        font-size: 1.1em;
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(45deg, #48bb78, #38a169);
        color: white;
        padding: 18px 25px;
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        transform: translateX(400px);
        transition: all 0.4s ease;
        z-index: 1000;
        backdrop-filter: blur(10px);
      }

      .notification.show {
        transform: translateX(0);
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(8px);
        z-index: 1000;
        animation: fadeIn 0.4s ease;
      }

      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 25px;
        padding: 35px;
        max-width: 600px;
        width: 90%;
        animation: scaleIn 0.4s ease;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
      }

      @keyframes pulse-glow {
        0%,
        100% {
          transform: translateX(-50%) scale(1);
          opacity: 0.5;
        }
        50% {
          transform: translateX(-50%) scale(1.1);
          opacity: 0.8;
        }
      }

      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(80px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse-urgent {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes scaleIn {
        from {
          transform: translate(-50%, -50%) scale(0.8);
          opacity: 0;
        }
        to {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }

      @media (max-width: 768px) {
        .dashboard-grid {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2.5em;
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
        }

        .video-container {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üè• HealthFlow</h1>
        <p>Advanced Telemedicine & Smart Follow-Up Platform</p>
      </div>

      <div class="hero-video">
        <video autoplay muted loop controls>
          <source
            src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
            type="video/mp4"
          />
          <source
            src="https://www.w3schools.com/html/mov_bbb.mp4"
            type="video/mp4"
          />
          Your browser does not support the video tag.
        </video>
        <div class="video-overlay">
          <h3>üåü Experience the Future of Healthcare</h3>
          <p>
            Connect with healthcare providers seamlessly through our advanced
            telemedicine platform. Schedule appointments, share medical
            documents, and receive personalized care from anywhere.
          </p>
        </div>
      </div>

      <div class="stats">
        <div class="stat-card">
          <span class="stat-icon">üë•</span>
          <div class="stat-number" id="totalPatients">247</div>
          <div class="stat-label">Active Patients</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">‚è∞</span>
          <div class="stat-number" id="pendingReminders">23</div>
          <div class="stat-label">Pending Reminders</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">üìÖ</span>
          <div class="stat-number" id="todayAppointments">8</div>
          <div class="stat-label">Today's Appointments</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">üìä</span>
          <div class="stat-number" id="successRate">94%</div>
          <div class="stat-label">Follow-up Rate</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">üìπ</span>
          <div class="stat-number" id="videoCalls">156</div>
          <div class="stat-label">Video Consultations</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">üìÑ</span>
          <div class="stat-number" id="documentsShared">342</div>
          <div class="stat-label">Documents Shared</div>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="card">
          <h2><span class="icon patient">üë§</span>Add New Patient</h2>
          <form id="patientForm">
            <div class="form-group">
              <label>Patient Name</label>
              <input
                type="text"
                id="patientName"
                required
                placeholder="Enter patient's full name"
              />
            </div>
            <div class="form-group">
              <label>Phone Number</label>
              <input
                type="tel"
                id="patientPhone"
                required
                placeholder="+1 (555) 123-4567"
              />
            </div>
            <div class="form-group">
              <label>Email Address</label>
              <input
                type="email"
                id="patientEmail"
                required
                placeholder="patient@email.com"
              />
            </div>
            <div class="form-group">
              <label>Medical Condition</label>
              <input
                type="text"
                id="patientCondition"
                required
                placeholder="Primary medical condition"
              />
            </div>
            <button type="submit" class="btn">Add Patient</button>
          </form>
        </div>

        <div class="card">
          <h2><span class="icon reminder">‚è∞</span>Schedule Follow-Up</h2>
          <form id="reminderForm">
            <div class="form-group">
              <label>Select Patient</label>
              <select id="selectPatient" required>
                <option value="">Choose a patient...</option>
              </select>
            </div>
            <div class="form-group">
              <label>Follow-up Date</label>
              <input type="datetime-local" id="followupDate" required />
            </div>
            <div class="form-group">
              <label>Reminder Method</label>
              <select id="reminderMethod" required>
                <option value="sms">SMS</option>
                <option value="whatsapp">WhatsApp</option>
                <option value="email">Email</option>
                <option value="all">All Methods</option>
              </select>
            </div>
            <div class="form-group">
              <label>Priority Level</label>
              <select id="priorityLevel" required>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
            <div class="form-group">
              <label>Custom Message</label>
              <textarea
                id="customMessage"
                rows="3"
                placeholder="Optional custom reminder message..."
              ></textarea>
            </div>
            <button type="submit" class="btn">Schedule Reminder</button>
          </form>
        </div>

        <div class="card">
          <h2><span class="icon upload">üìÅ</span>Document Upload</h2>
          <div class="file-upload" id="fileUploadArea">
            <div style="font-size: 3em; margin-bottom: 15px; color: #667eea">
              üìÑ
            </div>
            <h3 style="margin-bottom: 10px; color: #4a5568">
              Upload Medical Documents
            </h3>
            <p style="color: #718096; margin-bottom: 20px">
              Drag & drop files here or click to browse
            </p>
            <input
              type="file"
              id="fileInput"
              multiple
              accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
              style="display: none"
            />
            <button
              type="button"
              class="btn secondary"
              onclick="document.getElementById('fileInput').click()"
            >
              Choose Files
            </button>
          </div>
          <div class="file-list" id="fileList"></div>
        </div>

        <div class="card">
          <h2><span class="icon video">üìπ</span>Video Consultation</h2>
          <div class="video-call-section">
            <h3 style="margin-bottom: 20px">Start Video Call</h3>
            <div class="video-container">
              <div class="video-preview" id="localVideo">
                <span>Your Video</span>
              </div>
              <div class="video-preview" id="remoteVideo">
                <span>Patient Video</span>
              </div>
            </div>
            <div class="video-controls">
              <button
                class="control-btn call"
                id="startCallBtn"
                title="Start Call"
              >
                üìû
              </button>
              <button class="control-btn mute" id="muteBtn" title="Mute/Unmute">
                üé§
              </button>
              <button class="control-btn end" id="endCallBtn" title="End Call">
                üìµ
              </button>
            </div>
            <p style="margin-top: 20px; opacity: 0.9; font-size: 0.9em">
              Secure, HIPAA-compliant video consultations with patients
            </p>
          </div>
        </div>
      </div>

      <div class="reminder-list">
        <h2>
          <span class="icon analytics">üìä</span>Active Reminders & Appointments
        </h2>
        <div id="remindersList">
          <!-- Reminders will be populated here -->
        </div>
      </div>

      <div class="ai-insights">
        <h3>ü§ñ AI-Powered Healthcare Insights</h3>
        <p id="aiInsight">
          Analyzing patient follow-up patterns and optimizing reminder schedules
          for maximum effectiveness...
        </p>
      </div>
    </div>

    <div class="notification" id="notification">
      <span id="notificationText">Notification message</span>
    </div>

    <div class="modal" id="reminderModal">
      <div class="modal-content">
        <h3>Reminder Details</h3>
        <div id="reminderDetails"></div>
        <button class="btn" onclick="closeModal()">Close</button>
      </div>
    </div>

    <script>
      // In-memory data storage
      let patients = [
        {
          id: 1,
          name: "John Doe",
          phone: "+1234567890",
          email: "john@email.com",
          condition: "Hypertension",
        },
        {
          id: 2,
          name: "Jane Smith",
          phone: "+1234567891",
          email: "jane@email.com",
          condition: "Diabetes",
        },
        {
          id: 3,
          name: "Mike Johnson",
          phone: "+1234567892",
          email: "mike@email.com",
          condition: "Asthma",
        },
      ];

      let reminders = [
        {
          id: 1,
          patientId: 1,
          date: new Date(Date.now() + 86400000),
          method: "sms",
          priority: "high",
          message: "Please remember your follow-up appointment tomorrow.",
          status: "pending",
        },
        {
          id: 2,
          patientId: 2,
          date: new Date(Date.now() + 172800000),
          method: "email",
          priority: "medium",
          message: "Your diabetes check-up is scheduled in 2 days.",
          status: "pending",
        },
      ];

      let uploadedFiles = [];
      let patientIdCounter = 4;
      let reminderIdCounter = 3;
      let localStream = null;
      let isCallActive = false;
      let isMuted = false;

      // AI Insights generator
      const aiInsights = [
        "üìà Telemedicine consultations show 47% higher patient satisfaction rates compared to traditional visits.",
        "üí¨ WhatsApp reminders show 28% higher engagement rates compared to SMS.",
        "‚è∞ Optimal reminder time is between 9 AM - 11 AM for maximum patient response.",
        "üîî Multi-channel reminders (SMS + Email) reduce no-show rates by 42%.",
        "üìä Video consultations reduce travel time by an average of 2.5 hours per patient.",
        "üéØ Personalized messages improve patient satisfaction scores by 31%.",
        "üè• Remote monitoring through uploaded documents increases treatment adherence by 38%.",
        "üì± Mobile-first platforms increase patient engagement by 56% among younger demographics.",
      ];

      // Initialize the application
      function init() {
        populatePatientSelect();
        renderReminders();
        updateStats();
        startAIInsights();
        setupEventListeners();
        setupFileUpload();
        setupVideoCall();
      }

      function setupEventListeners() {
        document
          .getElementById("patientForm")
          .addEventListener("submit", addPatient);
        document
          .getElementById("reminderForm")
          .addEventListener("submit", scheduleReminder);
      }

      function setupFileUpload() {
        const fileUploadArea = document.getElementById("fileUploadArea");
        const fileInput = document.getElementById("fileInput");

        // Drag and drop events
        fileUploadArea.addEventListener("dragover", (e) => {
          e.preventDefault();
          fileUploadArea.classList.add("dragover");
        });

        fileUploadArea.addEventListener("dragleave", () => {
          fileUploadArea.classList.remove("dragover");
        });

        fileUploadArea.addEventListener("drop", (e) => {
          e.preventDefault();
          fileUploadArea.classList.remove("dragover");
          handleFiles(e.dataTransfer.files);
        });

        fileUploadArea.addEventListener("click", () => {
          fileInput.click();
        });

        fileInput.addEventListener("change", (e) => {
          handleFiles(e.target.files);
        });
      }

      function handleFiles(files) {
        for (let file of files) {
          const fileObj = {
            id: Date.now() + Math.random(),
            name: file.name,
            size: file.size,
            type: file.type,
            uploadDate: new Date(),
          };
          uploadedFiles.push(fileObj);
        }
        renderFileList();
        updateStats();
        showNotification(`${files.length} file(s) uploaded successfully!`);
      }

      function renderFileList() {
        const fileList = document.getElementById("fileList");
        fileList.innerHTML = "";

        if (uploadedFiles.length === 0) {
          fileList.innerHTML =
            '<p style="text-align: center; color: #718096; font-style: italic;">No files uploaded yet</p>';
          return;
        }

        uploadedFiles.forEach((file) => {
          const fileItem = document.createElement("div");
          fileItem.className = "file-item";

          const fileIcon = getFileIcon(file.type);
          const fileSize = formatFileSize(file.size);

          fileItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5em;">${fileIcon}</span>
                        <div>
                            <div style="font-weight: 600; color: #4a5568;">${
                              file.name
                            }</div>
                            <div style="font-size: 0.8em; color: #718096;">${fileSize} ‚Ä¢ ${file.uploadDate.toLocaleDateString()}</div>
                        </div>
                    </div>
                    <button onclick="removeFile('${
                      file.id
                    }')" style="background: #f56565; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                        Remove
                    </button>
                `;

          fileList.appendChild(fileItem);
        });
      }

      function getFileIcon(type) {
        if (type.includes("pdf")) return "üìÑ";
        if (type.includes("image")) return "üñºÔ∏è";
        if (type.includes("doc")) return "üìù";
        return "üìé";
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      function removeFile(fileId) {
        uploadedFiles = uploadedFiles.filter((file) => file.id !== fileId);
        renderFileList();
        updateStats();
        showNotification("File removed successfully!");
      }

      function setupVideoCall() {
        const startCallBtn = document.getElementById("startCallBtn");
        const muteBtn = document.getElementById("muteBtn");
        const endCallBtn = document.getElementById("endCallBtn");

        startCallBtn.addEventListener("click", startVideoCall);
        muteBtn.addEventListener("click", toggleMute);
        endCallBtn.addEventListener("click", endVideoCall);
      }

      async function startVideoCall() {
        if (isCallActive) {
          showNotification("Call is already active!");
          return;
        }

        try {
          // Request camera and microphone access
          localStream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: true,
          });

          const localVideo = document.getElementById("localVideo");
          const videoElement = document.createElement("video");
          videoElement.srcObject = localStream;
          videoElement.autoplay = true;
          videoElement.muted = true; // Prevent echo
          videoElement.style.width = "100%";
          videoElement.style.height = "100%";
          videoElement.style.objectFit = "cover";
          videoElement.style.borderRadius = "15px";

          localVideo.innerHTML = "";
          localVideo.appendChild(videoElement);

          isCallActive = true;
          updateVideoCallUI();
          showNotification("Video call started successfully!");

          // Simulate connecting to remote patient (in real app, this would use WebRTC)
          setTimeout(() => {
            simulateRemoteConnection();
          }, 2000);
        } catch (error) {
          console.error("Error accessing camera/microphone:", error);
          showNotification(
            "Error: Could not access camera/microphone. Please check permissions."
          );
        }
      }

      function simulateRemoteConnection() {
        const remoteVideo = document.getElementById("remoteVideo");
        remoteVideo.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: white;">
                    <div style="font-size: 3em; margin-bottom: 10px;">üë®‚Äç‚öïÔ∏è</div>
                    <div style="font-size: 1.2em; margin-bottom: 10px;">Patient Connected</div>
                    <div style="font-size: 0.9em; opacity: 0.8;">Simulated Connection</div>
                    <div style="position: absolute; top: 10px; right: 10px; background: #48bb78; padding: 5px 10px; border-radius: 15px; font-size: 0.8em;">
                        üü¢ LIVE
                    </div>
                </div>
            `;
        showNotification("Patient connected to the call!");
      }

      function toggleMute() {
        if (!localStream) {
          showNotification("No active call to mute!");
          return;
        }

        const audioTracks = localStream.getAudioTracks();
        audioTracks.forEach((track) => {
          track.enabled = !track.enabled;
        });

        isMuted = !isMuted;
        updateVideoCallUI();
        showNotification(isMuted ? "Microphone muted" : "Microphone unmuted");
      }

      function endVideoCall() {
        if (!isCallActive) {
          showNotification("No active call to end!");
          return;
        }

        if (localStream) {
          localStream.getTracks().forEach((track) => track.stop());
          localStream = null;
        }

        const localVideo = document.getElementById("localVideo");
        const remoteVideo = document.getElementById("remoteVideo");

        localVideo.innerHTML = "<span>Your Video</span>";
        remoteVideo.innerHTML = "<span>Patient Video</span>";

        isCallActive = false;
        isMuted = false;
        updateVideoCallUI();
        showNotification("Video call ended");
      }

      function updateVideoCallUI() {
        const startCallBtn = document.getElementById("startCallBtn");
        const muteBtn = document.getElementById("muteBtn");
        const endCallBtn = document.getElementById("endCallBtn");

        if (isCallActive) {
          startCallBtn.style.opacity = "0.5";
          startCallBtn.style.cursor = "not-allowed";
          muteBtn.style.opacity = "1";
          muteBtn.style.cursor = "pointer";
          endCallBtn.style.opacity = "1";
          endCallBtn.style.cursor = "pointer";

          muteBtn.innerHTML = isMuted ? "üîá" : "üé§";
          muteBtn.style.background = isMuted
            ? "linear-gradient(45deg, #f56565, #e53e3e)"
            : "linear-gradient(45deg, #ed8936, #dd6b20)";
        } else {
          startCallBtn.style.opacity = "1";
          startCallBtn.style.cursor = "pointer";
          muteBtn.style.opacity = "0.5";
          muteBtn.style.cursor = "not-allowed";
          endCallBtn.style.opacity = "0.5";
          endCallBtn.style.cursor = "not-allowed";
          muteBtn.innerHTML = "üé§";
        }
      }

      function populatePatientSelect() {
        const select = document.getElementById("selectPatient");
        select.innerHTML = '<option value="">Choose a patient...</option>';

        patients.forEach((patient) => {
          const option = document.createElement("option");
          option.value = patient.id;
          option.textContent = `${patient.name} - ${patient.condition}`;
          select.appendChild(option);
        });
      }

      function addPatient(e) {
        e.preventDefault();

        const newPatient = {
          id: patientIdCounter++,
          name: document.getElementById("patientName").value,
          phone: document.getElementById("patientPhone").value,
          email: document.getElementById("patientEmail").value,
          condition: document.getElementById("patientCondition").value,
        };

        patients.push(newPatient);
        populatePatientSelect();
        updateStats();
        showNotification("Patient added successfully!");

        document.getElementById("patientForm").reset();

        const form = document.getElementById("patientForm");
        form.style.transform = "scale(0.98)";
        setTimeout(() => {
          form.style.transform = "scale(1)";
        }, 200);
      }

      function scheduleReminder(e) {
        e.preventDefault();

        const newReminder = {
          id: reminderIdCounter++,
          patientId: parseInt(document.getElementById("selectPatient").value),
          date: new Date(document.getElementById("followupDate").value),
          method: document.getElementById("reminderMethod").value,
          priority: document.getElementById("priorityLevel").value,
          message:
            document.getElementById("customMessage").value ||
            generateDefaultMessage(),
          status: "pending",
        };

        reminders.push(newReminder);
        renderReminders();
        updateStats();
        showNotification("Reminder scheduled successfully!");

        document.getElementById("reminderForm").reset();

        setTimeout(() => {
          simulateReminderSent(newReminder);
        }, 2000);
      }

      function generateDefaultMessage() {
        const messages = [
          "Don't forget about your upcoming medical appointment.",
          "Your health is important - please remember your follow-up visit.",
          "Reminder: You have a scheduled appointment with your healthcare provider.",
          "Time for your check-up! Please confirm your appointment.",
        ];
        return messages[Math.floor(Math.random() * messages.length)];
      }

      function renderReminders() {
        const container = document.getElementById("remindersList");
        container.innerHTML = "";

        if (reminders.length === 0) {
          container.innerHTML =
            '<p style="text-align: center; color: #718096; font-style: italic;">No active reminders</p>';
          return;
        }

        reminders.sort((a, b) => new Date(a.date) - new Date(b.date));

        reminders.forEach((reminder) => {
          const patient = patients.find((p) => p.id === reminder.patientId);
          if (!patient) return;

          const reminderEl = document.createElement("div");
          reminderEl.className = `reminder-item ${
            reminder.priority === "urgent" ? "urgent" : ""
          } ${reminder.status === "completed" ? "completed" : ""}`;

          const timeUntil = getTimeUntil(reminder.date);
          const statusIcon = reminder.status === "completed" ? "‚úÖ" : "‚è≥";
          const methodIcon = {
            sms: "üì±",
            whatsapp: "üí¨",
            email: "üìß",
            all: "üåê",
          }[reminder.method];

          reminderEl.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong>${statusIcon} ${patient.name}</strong>
                        <span style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8em;">
                            ${reminder.priority.toUpperCase()}
                        </span>
                    </div>
                    <div style="color: #718096; margin-bottom: 8px;">
                        ${methodIcon} ${reminder.method.toUpperCase()} ‚Ä¢ ${timeUntil}
                    </div>
                    <div style="color: #4a5568; font-size: 0.9em;">
                        ${reminder.message.substring(0, 100)}${
            reminder.message.length > 100 ? "..." : ""
          }
                    </div>
                `;

          reminderEl.addEventListener("click", () =>
            showReminderModal(reminder, patient)
          );
          container.appendChild(reminderEl);
        });
      }

      function getTimeUntil(date) {
        const now = new Date();
        const diff = date - now;

        if (diff < 0) return "Overdue";

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor(
          (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
        );

        if (days > 0) return `In ${days} day${days > 1 ? "s" : ""}`;
        if (hours > 0) return `In ${hours} hour${hours > 1 ? "s" : ""}`;

        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        return `In ${minutes} minute${minutes > 1 ? "s" : ""}`;
      }

      function showReminderModal(reminder, patient) {
        const modal = document.getElementById("reminderModal");
        const details = document.getElementById("reminderDetails");

        details.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <strong>Patient:</strong> ${patient.name}<br>
                    <strong>Phone:</strong> ${patient.phone}<br>
                    <strong>Email:</strong> ${patient.email}<br>
                    <strong>Condition:</strong> ${patient.condition}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Appointment:</strong> ${reminder.date.toLocaleString()}<br>
                    <strong>Method:</strong> ${reminder.method.toUpperCase()}<br>
                    <strong>Priority:</strong> ${reminder.priority.toUpperCase()}<br>
                    <strong>Status:</strong> ${reminder.status.toUpperCase()}
                </div>
                <div>
                    <strong>Message:</strong><br>
                    <em>"${reminder.message}"</em>
                </div>
            `;

        modal.style.display = "block";
      }

      function closeModal() {
        document.getElementById("reminderModal").style.display = "none";
      }

      function updateStats() {
        document.getElementById("totalPatients").textContent = patients.length;
        document.getElementById("pendingReminders").textContent =
          reminders.filter((r) => r.status === "pending").length;
        document.getElementById("documentsShared").textContent =
          uploadedFiles.length;

        const today = new Date();
        const todayReminders = reminders.filter((r) => {
          const reminderDate = new Date(r.date);
          return reminderDate.toDateString() === today.toDateString();
        });
        document.getElementById("todayAppointments").textContent =
          todayReminders.length;

        animateNumbers();
      }

      function animateNumbers() {
        const statNumbers = document.querySelectorAll(".stat-number");
        statNumbers.forEach((el) => {
          if (!el.textContent.includes("%")) {
            el.style.transform = "scale(1.1)";
            setTimeout(() => {
              el.style.transform = "scale(1)";
            }, 300);
          }
        });
      }

      function showNotification(message) {
        const notification = document.getElementById("notification");
        const text = document.getElementById("notificationText");

        text.textContent = message;
        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      function simulateReminderSent(reminder) {
        const patient = patients.find((p) => p.id === reminder.patientId);
        if (patient) {
          showNotification(
            `Reminder sent to ${
              patient.name
            } via ${reminder.method.toUpperCase()}!`
          );

          setTimeout(() => {
            reminder.status = Math.random() > 0.1 ? "completed" : "failed";
            renderReminders();
            updateStats();
          }, 1000);
        }
      }

      function startAIInsights() {
        let currentInsight = 0;

        function updateInsight() {
          const insightEl = document.getElementById("aiInsight");
          insightEl.style.opacity = "0";

          setTimeout(() => {
            insightEl.textContent = aiInsights[currentInsight];
            insightEl.style.opacity = "1";
            currentInsight = (currentInsight + 1) % aiInsights.length;
          }, 500);
        }

        setInterval(updateInsight, 5000);
        updateInsight();
      }

      function simulateRealTimeUpdates() {
        setInterval(() => {
          if (Math.random() > 0.7) {
            const successRate = document.getElementById("successRate");
            const rates = ["92%", "94%", "96%", "91%", "95%"];
            successRate.textContent =
              rates[Math.floor(Math.random() * rates.length)];
          }

          if (Math.random() > 0.8) {
            const videoCalls = document.getElementById("videoCalls");
            const currentCalls = parseInt(videoCalls.textContent);
            videoCalls.textContent =
              currentCalls + Math.floor(Math.random() * 3);
          }
        }, 10000);
      }

      // Close modal when clicking outside
      window.addEventListener("click", (e) => {
        const modal = document.getElementById("reminderModal");
        if (e.target === modal) {
          closeModal();
        }
      });

      // Initialize the application
      init();
      simulateRealTimeUpdates();

      setTimeout(() => {
        showNotification("HealthFlow system initialized successfully! üè•");
      }, 1000);

      setTimeout(() => {
        showNotification("Video consultation & file upload ready! üìπüìÅ");
      }, 3000);
    </script>
  </body>
</html>
